// Use DBML to define your database structure
// Docs: https://dbml.dbdiagram.io/docsqd

Table roles {
  id uuid [pk]
  name varchar(50) [unique, not null]
  description text
  created_at timestamp [not null, default: `now()`]
}

Table platform_settings {
  id uuid [pk]
  logo_url varchar(500)
  platform_name varchar(255) [not null]
  display_name varchar(255)
  payment_currency varchar(3) [not null, default: 'USD']
  timezone varchar(100) [not null, default: 'UTC']
  whatsapp_number varchar(50)
  facebook_url varchar(500)
  twitter_url varchar(500)
  instagram_url varchar(500)
  linkedin_url varchar(500)
  youtube_url varchar(500)
  tiktok_url varchar(500)
  created_at timestamp [not null, default: `now()`]
  updated_at timestamp [not null, default: `now()`]
  
  Note: 'Singleton table for global platform configuration'
}

Table learning_streams {
  id uuid [pk]
  name varchar(100) [unique, not null]
  description text
  created_at timestamp [not null, default: `now()`]
  
  Note: 'Major learning categories (NCA, Ontario Bar)'
}

Table exam_types {
  id uuid [pk]
  stream_id uuid [not null, ref: > learning_streams.id]
  name varchar(100) [not null]
  description text
  created_at timestamp [not null, default: `now()`]
  
  indexes {
    stream_id
    (stream_id, name) [unique]
  }
  
  Note: 'Exam categories within streams (Solicitor, Barrister)'
}

Table users {
  id uuid [pk]
  name varchar(255) [not null]
  email varchar(255) [unique, not null]
  password_hash varchar(255) [not null]
  role_id uuid [not null, ref: > roles.id]
  is_active boolean [not null, default: true]
  created_at timestamp [not null, default: `now()`]
  updated_at timestamp [not null, default: `now()`]
  
  indexes {
    email
    role_id
    is_active
  }
}

Table subjects {
  id uuid [pk]
  title varchar(255) [not null]
  description text
  thumbnail varchar(500)
  demo_video_url varchar(500)
  syllabus_pdf_url varchar(500)
  objectives text
  additional_coverage text
  stream_id uuid [not null, ref: > learning_streams.id]
  exam_type_id uuid [ref: > exam_types.id]
  bundle_price decimal(10,2)
  is_bundle_enabled boolean [not null, default: false]
  is_featured boolean [not null, default: false]
  is_mandatory boolean [not null, default: false]
  is_active boolean [not null, default: true]
  created_at timestamp [not null, default: `now()`]
  updated_at timestamp [not null, default: `now()`]
  
  indexes {
    stream_id
    exam_type_id
    is_active
  }
  
  Note: 'Individual subjects within learning streams/exam types'
}

Table content_types {
  id uuid [pk]
  name varchar(50) [unique, not null]
  description text
  created_at timestamp [not null, default: `now()`]
  
  Note: 'Types of content: Video Lectures, Notes, Question & Answers, IRACs'
}

Table subject_contents {
  id uuid [pk]
  subject_id uuid [not null, ref: > subjects.id]
  content_type_id uuid [not null, ref: > content_types.id]
  title varchar(255) [not null]
  description text
  file_url text
  duration integer
  price decimal(10,2) [not null, default: 0]
  sort_order integer [not null, default: 0]
  is_active boolean [not null, default: true]
  created_at timestamp [not null, default: `now()`]
  updated_at timestamp [not null, default: `now()`]
  
  indexes {
    subject_id
    content_type_id
  }
  
  Note: 'Actual course content (PDFs, Videos, Question Bank)'
}

Table purchases {
  id uuid [pk]
  user_id uuid [not null, ref: > users.id]
  subject_id uuid [not null, ref: > subjects.id]
  content_type_id uuid [ref: > content_types.id]
  is_bundle boolean [not null, default: false]
  amount decimal(10,2) [not null]
  status varchar(50) [not null, default: 'pending']
  transaction_id varchar(255)
  stripe_session_id varchar(255)
  stripe_payment_intent_id varchar(255)
  created_at timestamp [not null, default: `now()`]
  
  indexes {
    user_id
    subject_id
    stripe_session_id
    status
    (user_id, subject_id)
  }
  
  Note: 'Individual content purchases - status: pending, paid, failed, refunded'
}

Table user_access {
  id uuid [pk]
  user_id uuid [not null, ref: > users.id]
  subject_id uuid [not null, ref: > subjects.id]
  content_type_id uuid [not null, ref: > content_types.id]
  granted_at timestamp [not null, default: `now()`]
  
  indexes {
    user_id
    subject_id
    (user_id, subject_id, content_type_id) [unique]
  }
  
  Note: 'Grants lifetime access to content'
}

Table cart {
  id uuid [pk]
  user_id uuid [not null, ref: > users.id]
  subject_id uuid [not null, ref: > subjects.id]
  content_type_id uuid [ref: > content_types.id]
  is_bundle boolean [not null, default: false]
  price decimal(10,2) [not null]
  created_at timestamp [not null, default: `now()`]
  
  indexes {
    user_id
  }
}

Table offers {
  id uuid [pk]
  name varchar(255) [not null]
  code varchar(100) [unique, not null]
  discount_type varchar(20) [not null]
  discount_value decimal(10,2) [not null]
  subject_id uuid [ref: > subjects.id]
  content_type_id uuid [ref: > content_types.id]
  max_usage integer
  current_usage integer [not null, default: 0]
  valid_from timestamp [not null]
  valid_until timestamp [not null]
  is_active boolean [not null, default: true]
  created_at timestamp [not null, default: `now()`]
  updated_at timestamp [not null, default: `now()`]
  
  indexes {
    code
    is_active
  }
  
  Note: 'Promotional discount codes - discount_type: percentage or fixed'
}

Table password_reset_tokens {
  id uuid [pk]
  user_id uuid [not null, ref: > users.id]
  token varchar(255) [unique, not null]
  expires_at timestamp [not null]
  created_at timestamp [not null, default: `now()`]
}

Table email_templates {
  id uuid [pk]
  name varchar(100) [unique, not null]
  subject varchar(255) [not null]
  html_content text [not null]
  text_content text [not null]
  created_at timestamp [not null, default: `now()`]
  updated_at timestamp [not null, default: `now()`]
  
  Note: 'Templates like RESET_PASSWORD, WELCOME_EMAIL'
}

Table session_types {
  id uuid [pk]
  title varchar(255) [not null]
  description text
  duration integer [not null]
  price decimal(10,2) [not null]
  is_active boolean [not null, default: true]
  created_at timestamp [not null, default: `now()`]
  updated_at timestamp [not null, default: `now()`]
  
  Note: 'Available session types for booking - duration in minutes'
}

Table session_bookings {
  id uuid [pk]
  user_id uuid [not null, ref: > users.id]
  session_type_id uuid [not null, ref: > session_types.id]
  full_name varchar(255) [not null]
  email varchar(255) [not null]
  gmail varchar(255)
  whatsapp varchar(50)
  province varchar(100)
  country varchar(100)
  status varchar(50) [not null, default: 'pending']
  stripe_session_id varchar(255)
  stripe_purchase_id varchar(255)
  amount_paid decimal(10,2)
  notes text
  created_at timestamp [not null, default: `now()`]
  updated_at timestamp [not null, default: `now()`]
  
  indexes {
    user_id
    session_type_id
    status
    stripe_session_id
  }
  
  Note: 'Booking requests from learners - status: pending, confirmed, completed, cancelled'
}

Table support_tickets {
  id uuid [pk]
  user_id uuid [not null, ref: > users.id]
  subject varchar(500) [not null]
  category varchar(50) [not null]
  status varchar(50) [not null, default: 'new']
  created_at timestamp [not null, default: `now()`]
  updated_at timestamp [not null, default: `now()`]
  
  indexes {
    user_id
    status
  }
  
  Note: 'User support requests - category: issue, question, feedback, refund; status: new, pending, resolved'
}

Table support_ticket_messages {
  id uuid [pk]
  ticket_id uuid [not null, ref: > support_tickets.id]
  user_id uuid [ref: > users.id]
  message text [not null]
  is_from_admin boolean [not null, default: false]
  created_at timestamp [not null, default: `now()`]
  
  indexes {
    ticket_id
  }
  
  Note: 'Conversation thread for each ticket'
}

Table blog_posts {
  id uuid [pk]
  title varchar(500) [not null]
  slug varchar(500) [unique, not null]
  image varchar(1000)
  content text [not null]
  excerpt text
  author_id uuid [not null, ref: > users.id]
  is_published boolean [not null, default: false]
  published_at timestamp
  created_at timestamp [not null, default: `now()`]
  updated_at timestamp [not null, default: `now()`]
  
  indexes {
    slug
    author_id
    is_published
  }
  
  Note: 'Blog articles with featured images'
}